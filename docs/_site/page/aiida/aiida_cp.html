<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AiiDA cp.x | personal website</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="AiiDA cp.x" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/page/aiida/aiida_cp.html" />
<meta property="og:url" content="http://localhost:4000/page/aiida/aiida_cp.html" />
<meta property="og:site_name" content="personal website" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AiiDA cp.x" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"AiiDA cp.x","url":"http://localhost:4000/page/aiida/aiida_cp.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=c90158fd34f66e4f63b4da45038b5d6170d798eb">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    

<!--  -->

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="http://localhost:4000/">personal website</a></h1>

        

        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>

        
        <p class="view"><a href="https://github.com/dirac6582/dirac6582.github.io.git">View the Project on GitHub <small>dirac6582/dirac6582.github.io.git</small></a></p>
        

        

        
      </header>
      <section>

      <h1 id="aiida-cpx">AiiDA cp.x</h1>

<h2 id="trajectory"><a href="https://aiida.readthedocs.io/projects/aiida-core/en/latest/reference/apidoc/aiida.orm.nodes.data.array.html?highlight=TrajectoryData#aiida.orm.nodes.data.array.trajectory.TrajectoryData">Trajectory</a></h2>

<p>pw.xの結晶構造緩和計算でもそうだったが，AiiDAではシミュレーション中に原子が動く様子を<a href="https://aiida.readthedocs.io/projects/aiida-core/en/latest/topics/data_types.html?highlight=TrajectoryData#trajectorydata">TrajectoryData</a>として取得できる．これによって，コマンドラインから簡単な可視化ができると同時に，pythonコード中でより細かくデータを解析したい場合にも便利である．</p>

<ul>
  <li>
    <p>コマンドラインから構造を手っ取り早く可視化する．</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  verdi data core.trajectory show &lt;pk&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>xyzファイルからTrajectoryDataにインポート</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">aiida.orm.nodes.data.array.trajectory</span> <span class="kn">import</span> <span class="n">TrajectoryData</span>
  <span class="n">t</span><span class="o">=</span> <span class="n">TrajectoryData</span><span class="p">()</span>
  <span class="c1"># get sites and number of timesteps
</span>  <span class="n">t</span><span class="p">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">'steps'</span><span class="p">,</span> <span class="n">arange</span><span class="p">(</span><span class="n">ntimesteps</span><span class="p">))</span>
  <span class="n">t</span><span class="p">.</span><span class="n">set_array</span><span class="p">(</span><span class="s">'symbols'</span><span class="p">,</span> <span class="n">array</span><span class="p">([</span><span class="n">site</span><span class="p">.</span><span class="n">kind</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">s</span><span class="p">.</span><span class="n">sites</span><span class="p">]))</span>
  <span class="n">t</span><span class="p">.</span><span class="n">importfile</span><span class="p">(</span><span class="s">'some-calc/AIIDA-PROJECT-pos-1.xyz'</span><span class="p">,</span> <span class="s">'xyz_pos'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>原子座標などの情報を抽出</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># 原子座標
</span>  <span class="n">t</span><span class="p">.</span><span class="n">get_positions</span><span class="p">()</span>
  <span class="c1"># 時間データ
</span>  <span class="n">t</span><span class="p">.</span><span class="n">get_times</span><span class="p">()</span>

  <span class="c1"># 
</span>  <span class="n">t</span><span class="p">.</span><span class="n">get_step_data</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
  <span class="c1"># ある時間ステップの構造をStructureDataとして取得(常にPBC=true)
</span>  <span class="n">t</span><span class="p">.</span><span class="n">get_step_structure</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
  <span class="c1"># 
</span>  <span class="n">t</span><span class="p">.</span><span class="n">get_structure</span><span class="p">(</span><span class="n">converter</span><span class="o">=</span><span class="s">"ase"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="cp-wf-計算">cp-wf 計算</h2>

<p>AiiDAはcalculationとしてcpしか受け付けないようになっており，cp-wf計算はそのままではエラーで実行してくれないことになっている．しかし，このエラーはインプットファイルを作成するときにNAMELISTを自動生成するルーチンがうまく動かないというだけのことであり，その部分を回避すれば普通にジョブ投入は成功する．この点は<a href="https://aiida-quantumespresso.readthedocs.io/en/latest/user_guide/calculation_plugins/pw.html#pw-advanced-features">公式でも言及</a>されており，自動生成されるNAMELISTを上書きしたいときはsettingsタグを使うようにと指摘されている．例えばcp-wf計算をしたい場合は，calculation=cp-wfとした上で，ビルダーにsettingsタグを追加する．</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">settings_dict</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">'namelists'</span><span class="p">:</span> <span class="p">[</span><span class="s">'CONTROL'</span><span class="p">,</span> <span class="s">'SYSTEM'</span><span class="p">,</span> <span class="s">'ELECTRONS'</span><span class="p">,</span> <span class="s">'IONS'</span><span class="p">,</span> <span class="s">'CELL'</span><span class="p">,</span> <span class="s">'WANNIER'</span> <span class="p">],</span>
 <span class="p">}</span>
 <span class="n">builder</span><span class="p">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">orm</span><span class="p">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>
</code></pre></div></div>

<p>これで通常のcp-wf計算が実行できる．ただし現状では，おそらくwfcファイルをちゃんと扱ってくれないくれないのでここは手でやる必要がある．</p>


      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/dirac6582">dirac6582</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
